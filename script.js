function toggleMenu(){const t=document.getElementById("menu"),e=document.querySelector(".hamburger-icon");t.classList.toggle("active"),t.classList.contains("active")?e.innerHTML="&#10006;":e.innerHTML="&#9776;"}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("image-upload"),e=document.getElementById("file-info"),n=document.getElementById("image-list"),i=document.getElementById("preview-canvas"),a=i.getContext("2d"),l=document.getElementById("generate-pdf"),o=document.getElementById("clear-all"),c=document.getElementById("crop-btn"),r=document.getElementById("rotate-left-btn"),s=document.getElementById("rotate-right-btn"),d=document.getElementById("flip-h-btn"),h=document.getElementById("flip-v-btn"),g=document.getElementById("filter-select"),m=document.getElementById("reset-btn"),f=document.getElementById("crop-overlay"),u=document.getElementById("crop-area"),p=document.getElementById("apply-crop"),v=document.getElementById("cancel-crop");let w,I,y,E,L=[],b=0,D=!1,B=!1;function M(){i.width=800,i.height=600,a.fillStyle="#f8f9fa",a.fillRect(0,0,i.width,i.height),a.textAlign="center",a.fillStyle="#666",a.font="20px Arial",a.fillText("Upload an image to start editing",i.width/2,i.height/2)}function x(){if(0===L.length)return void M();const t=L[b],e=t.element;let n=e.width,l=e.height;t.rotation%180!=0&&([n,l]=[l,n]);let o=Math.min(800/n,600/l);i.width=n*o,i.height=l*o,a.save(),a.clearRect(0,0,i.width,i.height),a.translate(i.width/2,i.height/2),a.rotate(t.rotation*Math.PI/180);let c=t.flip.horizontal?-1:1,r=t.flip.vertical?-1:1;a.scale(c,r),a.drawImage(e,-n*o/2,-l*o/2,n*o,l*o),t.filters.grayscale&&function(){const t=a.getImageData(0,0,i.width,i.height),e=t.data;for(let t=0;t<e.length;t+=4){const n=(e[t]+e[t+1]+e[t+2])/3;e[t]=n,e[t+1]=n,e[t+2]=n}a.putImageData(t,0,0)}(),t.filters.sepia&&function(){const t=a.getImageData(0,0,i.width,i.height),e=t.data;for(let t=0;t<e.length;t+=4){const n=e[t],i=e[t+1],a=e[t+2];e[t]=Math.min(255,.393*n+.769*i+.189*a),e[t+1]=Math.min(255,.349*n+.686*i+.168*a),e[t+2]=Math.min(255,.272*n+.534*i+.131*a)}a.putImageData(t,0,0)}(),t.filters.invert&&function(){const t=a.getImageData(0,0,i.width,i.height),e=t.data;for(let t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2];a.putImageData(t,0,0)}(),t.filters.blur&&function(){const t=a.getImageData(0,0,i.width,i.height).data,e=new Uint8ClampedArray(t.length),n=2,l=i.width,o=i.height;for(let i=0;i<o;i++)for(let a=0;a<l;a++){let c=0,r=0,s=0,d=0,h=0;for(let e=-n;e<=n;e++)for(let g=-n;g<=n;g++){const n=a+g,m=i+e;if(n>=0&&n<l&&m>=0&&m<o){const e=4*(m*l+n);c+=t[e],r+=t[e+1],s+=t[e+2],d+=t[e+3],h++}}const g=4*(i*l+a);e[g]=c/h,e[g+1]=r/h,e[g+2]=s/h,e[g+3]=d/h}a.putImageData(new ImageData(e,l,o),0,0)}(),100!==t.filters.brightness&&function(t){const e=a.getImageData(0,0,i.width,i.height),n=e.data,l=t/100;for(let t=0;t<n.length;t+=4)n[t]=n[t]*l,n[t+1]=n[t+1]*l,n[t+2]=n[t+2]*l;a.putImageData(e,0,0)}(t.filters.brightness),100!==t.filters.contrast&&function(t){const e=a.getImageData(0,0,i.width,i.height),n=e.data,l=259*(t+255)/(255*(259-t));for(let t=0;t<n.length;t+=4)n[t]=l*(n[t]-128)+128,n[t+1]=l*(n[t+1]-128)+128,n[t+2]=l*(n[t+2]-128)+128;a.putImageData(e,0,0)}(t.filters.contrast),a.restore()}t.addEventListener("change",(function(t){const i=t.target.files;0!==i.length&&(L=[],n.innerHTML="",Array.from(i).forEach(((t,e)=>{if(!t.type.match("image.*"))return;const i=new FileReader;i.onload=function(i){const a=new Image;a.onload=function(){L.push({element:a,file:t,filters:{grayscale:!1,sepia:!1,invert:!1,blur:!1,brightness:100,contrast:100},rotation:0,flip:{horizontal:!1,vertical:!1},crop:null});const o=document.createElement("img");o.src=i.target.result,o.className="thumbnail",o.dataset.index=e,o.addEventListener("click",(function(){b=e,x(),document.querySelectorAll(".thumbnail").forEach((t=>t.classList.remove("active"))),this.classList.add("active")})),n.appendChild(o),0===e&&(b=0,o.classList.add("active"),x()),L.length>0&&(l.disabled=!1)},a.src=i.target.result},i.readAsDataURL(t)})),e.textContent=`${i.length} file(s) selected`)})),c.addEventListener("click",(function(){if(0===L.length)return;D=!0,f.classList.remove("hidden");const t=i.getBoundingClientRect(),e=.6*Math.min(t.width,t.height);u.style.width=`${e}px`,u.style.height=`${e}px`,u.style.left=(t.width-e)/2+"px",u.style.top=(t.height-e)/2+"px",w=(t.width-e)/2,I=(t.height-e)/2,y=w+e,E=I+e})),r.addEventListener("click",(function(){0!==L.length&&(L[b].rotation-=90,x())})),s.addEventListener("click",(function(){0!==L.length&&(L[b].rotation+=90,x())})),d.addEventListener("click",(function(){0!==L.length&&(L[b].flip.horizontal=!L[b].flip.horizontal,x())})),h.addEventListener("click",(function(){0!==L.length&&(L[b].flip.vertical=!L[b].flip.vertical,x())})),g.addEventListener("change",(function(){if(0===L.length)return;const t=L[b],e=this.value;switch(t.filters={grayscale:!1,sepia:!1,invert:!1,blur:!1,brightness:100,contrast:100},e){case"grayscale":t.filters.grayscale=!0;break;case"sepia":t.filters.sepia=!0;break;case"invert":t.filters.invert=!0;break;case"blur":t.filters.blur=!0;break;case"brightness":t.filters.brightness=150;break;case"contrast":t.filters.contrast=150}x()})),m.addEventListener("click",(function(){0!==L.length&&(L[b].filters={grayscale:!1,sepia:!1,invert:!1,blur:!1,brightness:100,contrast:100},L[b].rotation=0,L[b].flip={horizontal:!1,vertical:!1},L[b].crop=null,g.value="none",x())})),u.addEventListener("mousedown",(function(t){B=!0;const e=u.getBoundingClientRect(),n=t.clientX-e.left,a=t.clientY-e.top;function l(t){if(!B)return;const l=i.getBoundingClientRect(),o=t.clientX-l.left-n,c=t.clientY-l.top-a,r=l.width-e.width,s=l.height-e.height;u.style.left=`${Math.max(0,Math.min(r,o))}px`,u.style.top=`${Math.max(0,Math.min(s,c))}px`,w=parseInt(u.style.left),I=parseInt(u.style.top),y=w+e.width,E=I+e.height}document.addEventListener("mousemove",l),document.addEventListener("mouseup",(function t(){B=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",t)}))})),p.addEventListener("click",(function(){if(0===L.length)return;const t=L[b],e=i.getBoundingClientRect(),n=t.element.width/e.width,a=t.element.height/e.height;t.crop={x:w*n,y:I*a,width:(y-w)*n,height:(E-I)*a};const l=document.createElement("canvas");l.width=t.crop.width,l.height=t.crop.height;l.getContext("2d").drawImage(t.element,t.crop.x,t.crop.y,t.crop.width,t.crop.height,0,0,t.crop.width,t.crop.height);const o=new Image;o.onload=function(){t.element=o,t.crop=null,D=!1,f.classList.add("hidden"),x()},o.src=l.toDataURL()})),v.addEventListener("click",(function(){D=!1,f.classList.add("hidden")})),l.addEventListener("click",(async function(){if(0===L.length)return;const{jsPDF:t}=window.jspdf,e=new t;for(let t=0;t<L.length;t++){const n=L[t].element,i=e.internal.pageSize.getWidth()-20,a=e.internal.pageSize.getHeight()-20;let l=n.width,o=n.height;L[t].rotation%180!=0&&([l,o]=[o,l]);const c=Math.min(i/l,a/o),r=l*c,s=o*c,d=document.createElement("canvas");d.width=l,d.height=o;const h=d.getContext("2d");h.save(),h.translate(d.width/2,d.height/2),h.rotate(L[t].rotation*Math.PI/180);const g=L[t].flip.horizontal?-1:1,m=L[t].flip.vertical?-1:1;if(h.scale(g,m),h.drawImage(n,-l/2,-o/2,l,o),L[t].filters.grayscale){const t=h.getImageData(0,0,d.width,d.height),e=t.data;for(let t=0;t<e.length;t+=4){const n=(e[t]+e[t+1]+e[t+2])/3;e[t]=n,e[t+1]=n,e[t+2]=n}h.putImageData(t,0,0)}if(L[t].filters.sepia){const t=h.getImageData(0,0,d.width,d.height),e=t.data;for(let t=0;t<e.length;t+=4){const n=e[t],i=e[t+1],a=e[t+2];e[t]=Math.min(255,.393*n+.769*i+.189*a),e[t+1]=Math.min(255,.349*n+.686*i+.168*a),e[t+2]=Math.min(255,.272*n+.534*i+.131*a)}h.putImageData(t,0,0)}if(L[t].filters.invert){const t=h.getImageData(0,0,d.width,d.height),e=t.data;for(let t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2];h.putImageData(t,0,0)}h.restore(),t>0&&e.addPage(),e.addImage(d.toDataURL("image/jpeg",.8),"JPEG",10,10,r,s)}e.save("images.pdf")})),o.addEventListener("click",(function(){L=[],n.innerHTML="",e.textContent="No files selected",l.disabled=!0,M()})),M()}));
